{% extends 'layout/2column.html' %}

{% block html_title %}{{ path|path2name }} Â· {{ path }}{% endblock %}

{% block content_head %}

{% block content_head_before %}
{% endblock %}

<div class="header-wrap">
  {% if not page.isDeleted() %}
  <header id="page-header">
    <p class="stopper"><a href="#" data-affix-disable="#page-header"><i class="fa fa-chevron-up"></i></a></p>


    <div class="flex-title-line">
      <h1 class="title flex-item-title" id="revision-path">{{ path|insertSpaceToEachSlashes }}</h1>



      {% if page %}


      <div class="btn-group flex-item-action page-share-button">
        <button type="button" class="btn btn-default"><i class="fa fa-link"></i> Share</button>
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span class="caret"></span>
          <span class="sr-only">Toggle Dropdown</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right">
          <li><a href="#">Action</a></li>
          <li><a href="#">Another action</a></li>
          <li><a href="#">Something else here</a></li>
          <li role="separator" class="divider"></li>
          <li><a href="#">Separated link</a></li>
        </ul>
      </div>


      <div class="flex-item-action">
        <span id="bookmark-button">
          <p class="bookmark-link">
            <i class="fa fa-star-o"></i>
          </p>
        </span>
      </div>
      <div class="flex-item-action visible-xs visible-sm">
        <button
            data-csrftoken="{{ csrf() }}"
            data-liked="{% if page.isLiked(user) %}1{% else %}0{% endif %}"
            class="like-button btn btn-default btn-sm {% if page.isLiked(user) %}active{% endif %}"
        ><i class="fa fa-thumbs-o-up"></i></button>
      </div>
      {% endif %}
    </div>
  </header>
  {% else %}
  {# trash/* #}
  <header id="page-header">
    <div class="flex-title-line">
      <h1 class="title flex-item-title">{{ path|insertSpaceToEachSlashes }}</h1>
      <div class="flex-item-action">
        <span id="bookmark-button">
          <p class="bookmark-link">
            <i class="fa fa-star-o"></i>
          </a>
        </span>
      </div>
    </div>
  </header>
  {% endif %}
</div>

{% block content_head_after %}
{% endblock %}

{% endblock %}

{% block content_main %}

{% block content_main_before %}
{% endblock %}

<div id="content-main"
  class="content-main {% if not page or req.body.pageForm %}on-edit{% endif %}"
  data-path="{{ path }}"
  data-path-shortname="{{ path|path2name }}"
  data-page-id="{% if page %}{{ page._id.toString() }}{% endif %}"
  data-current-user="{% if user %}{{ user._id.toString() }}{% endif %}"
  data-current-username="{% if user %}{{ user.username }}{% endif %}"
  data-page-revision-id="{% if revision %}{{ revision._id.toString() }}{% endif %}"
  data-page-revision-created="{% if revision %}{{ revision.createdAt|datetz('U') }}{% endif %}"
  data-page-is-seen="{% if page and page.isSeenUser(user) %}1{% else %}0{% endif %}"
  data-csrftoken="{{ csrf() }}"
  >

  {% if not page %}
  <ul class="nav nav-tabs hidden-print">
    <li><a>Create: {{ path }}</a></li>
    <li class="dropdown pull-right">
      <a href="#" onclick="history.back();"><i class="fa fa-times"></i> {{ t('Cancel') }}</a>
    </li>
  </ul>
  <div class="tab-content">
    <div class="edit-form">
    {% include '_form.html' %}
    </div>
  </div>

  {% else %}

  {% include 'widget/page_content.html' %}

  {% endif %}

  <div id="notifPageEdited" class="fk-notif fk-notif-danger"><i class="fa fa-exclamation-triangle"></i> <span class="edited-user"></span> {{ t('edited this page') }} <a href="javascript:location.reload();"><i class="fa fa-angle-double-right"></i> {{ t('Load latest') }}</a></div>
</div>

{% block content_main_after %}
{% endblock %}

{% endblock %}

{% block content_footer %}


{% if page %}
<div class="page-attachments meta" id="page-attachment">
</div>

<p class="page-meta meta">
  Path: <span id="pagePath">{{ page.path }}</span><br>
  {# for BC #}
  {% if page.lastUpdateUser %}
    Last updated at {{ page.updatedAt|datetz('Y-m-d H:i:s') }} by <img src="{{ page.lastUpdateUser|picture }}" class="picture picture-rounded"> {{ page.lastUpdateUser.name }}<br>
  {% else %}
    Last updated at {{ page.revision.createdAt|datetz('Y-m-d H:i:s') }} by <img src="{{ page.revision.author|picture }}" class="picture picture-rounded"> {{ page.revision.author.name }}<br>
  {% endif %}
  {# /for BC #}
  Created at {{ page.createdAt|datetz('Y-m-d H:i:s') }} by <img src="{{ page.creator|default(page.creator)|picture }}" class="picture picture-rounded"> {{ page.creator.name }}<br>
</p>
{% endif %}

{% endblock %}

{% block side_header %}
  {% if not page.isDeleted() %}
    {% include 'widget/page_side_header.html' %}
  {% endif %}
{% endblock %} {# side_header #}

{% block side_content %}
  {% if not page.isDeleted() %}
    {% include 'widget/page_side_content.html' %}
  {% endif %}
{% endblock %}

{% block footer %}
{% endblock %}

{% block body_end %}
  {% parent %}

<div id="presentation-layer" class="fullscreen-layer">
  <div id="presentation-container"></div>
</div>

<div id="crowi-modals">
  {% include 'modal/rename.html' %}
  {% include 'modal/delete.html' %}
  {% include 'modal/page_name_warning.html' %}
</div>
{% endblock %}
